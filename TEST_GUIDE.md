# GraphRAG 테스트 가이드

## 현재 상태 (2026-01-28)

### DB 통계
- **문서**: 2,246개
- **용어**: 15,056개
- **관계**: 202개 (63% 증가, 이전 124개)
- **연결된 용어**: 268개 (1.8%)

### 최근 개선사항
✅ 온톨로지 룰 23개 추가 (총 65개 룰)
✅ 관계 선택 로직 개선 (가장 많은 관계를 가진 인스턴스 선택)
✅ 에러 처리 강화 (관계 없음 / 용어 없음 명확한 메시지)
✅ Hub node 필터링 적용 (specificity < 0.3)

---

## 테스트 방법

### 1. 웹 플랫폼 시작

```bash
# 터미널 1: Backend API 시작
cd /Users/mike/Desktop/playbook_nexus
python3 -m uvicorn src.api.main:app --reload --host 0.0.0.0 --port 8000

# 터미널 2: Frontend 시작
cd /Users/mike/Desktop/playbook_nexus/playbook-web
npm run dev
```

웹 브라우저에서 http://localhost:3000 접속

---

## 추천 테스트 쿼리

### ⭐ 관계가 많은 용어 (정상 동작 테스트)

1. **빈칸** (8개 관계 - GameObject)
   - "빈칸에 대해 알려줘"
   - "빈칸은 어떤 역할을 해?"
   - 실제 관계: counters → 고양이손, clears → 블록 등

2. **체리** (6개 관계 - Resource)
   - "체리는 어떻게 획득하나요?"
   - "체리로 뭘 할 수 있어?"
   - 실제 관계: 재도전 consumes 체리, 스테이지 consumes 체리 등

3. **클로버** (5개 관계 - Resource)
   - "클로버는 무엇인가요?"
   - "클로버를 어디에 사용하나요?"
   - 실제 관계: 미션 rewards 클로버, 상품 구매 consumes 클로버 등

4. **일반 스테이지** (4개 관계 - Content)
   - "일반 스테이지에 대해 설명해줘"

5. **오늘의 스테이지** (4개 관계 - Content)
   - "오늘의 스테이지는 뭐야?"

6. **블록** (4개 관계 - GameObject)
   - "블록은 뭐야?"
   - "블록을 어떻게 제거해?"

7. **구매 시스템** (5개 관계 - Mechanic)
   - "구매는 어떻게 하나요?"
   - "상품 구매 시스템 설명해줘"

### 🧪 에러 처리 테스트

8. **동물** (용어는 있지만 관계 없음)
   - "동물에 대해 알려줘"
   - 예상: "연결된 관계가 0개입니다" 에러 메시지

9. **포코타** (용어는 있지만 관계 없음)
   - "포코타는 뭐야?"
   - 예상: "연결된 관계가 0개입니다" 에러 메시지

### ❌ DB에 없는 용어 (Not Found 테스트)

10. **존재하지않는용어**
    - "존재하지않는용어에 대해 알려줘"
    - 예상: "용어를 찾을 수 없습니다" 에러 메시지

---

## 확인 포인트

### ✅ 정상 동작 확인
- [ ] 검색 과정 단계별 표시
- [ ] 추론 체인 표시 (보라색 박스)
- [ ] BFS 탐색 로그 표시 (노란색 박스)
- [ ] relation_type (CORE/FLOW) 표시
- [ ] weight (1-5) 표시
- [ ] 신뢰도 점수 표시

### ✅ 에러 처리 확인
- [ ] 관계 0개일 때 명확한 메시지
- [ ] 용어 없을 때 명확한 메시지
- [ ] 해결 방법 제시

### ✅ 관계 품질 확인
- [ ] 의미 있는 관계인가?
- [ ] CORE vs FLOW 분류가 적절한가?
- [ ] weight 우선순위가 합리적인가?
- [ ] 신뢰도가 합리적인가?

---

## 디버깅 도구

### 특정 용어의 관계 확인
```bash
python3 scripts/check_term_relations.py 빈칸
python3 scripts/check_term_relations.py 클로버
```

### 전체 진단
```bash
python3 scripts/diagnose_relations.py
```

### Phase 2 재실행 (관계만 재생성)
```bash
python3 run_phase2_only.py
```

---

## 알려진 제약사항

### 현재 한계
1. **연결률 낮음**: 1.8% (268/15,056 용어만 연결)
   - 원인: LLM이 raw_relations를 거의 생성하지 않음 (평균 0.0개)
   - 해결: Phase 1 프롬프트 개선 + 재실행 필요

2. **허브 노드 필터링**: specificity < 0.3 용어 필터링
   - 예: "스테이지" (단독) 관계 생성 안됨
   - "보스 스테이지", "일반 스테이지" 등은 OK

3. **온톨로지 룰**: 65개 룰로 제한
   - 신뢰도 기반 필터링으로 완화됨

### 다음 개선 계획
1. **LLM 프롬프트 강화** → Phase 1 재실행
   - relations 필드 필수화
   - JSON 검증 강화
   - 예상 효과: 관계 10배 증가 (202개 → 2,000+개)

2. **허브 노드 필터링 완화** (선택적)
   - specificity threshold 조정 (0.3 → 0.1)

---

## 성과 측정

### Phase 2 재실행 전후 비교
| 항목 | Before | After | 증가율 |
|------|--------|-------|--------|
| 관계 수 | 124 | 202 | +63% |
| 연결 용어 | 165 (1.1%) | 268 (1.8%) | +62% |
| CORE 관계 | 42 | 100 | +138% |
| FLOW 관계 | 82 | 102 | +24% |

### 다음 목표 (Phase 1 재실행 후)
- 관계: 2,000+개
- 연결률: 10%+
- 실용적인 GraphRAG 경험

---

## 문의 / 피드백

테스트 중 이슈 발견 시:
1. 스크린샷 + 질문 내용 기록
2. 로그 확인: `tail -f logs/playbook.log`
3. 관계 확인: `python3 scripts/check_term_relations.py <용어>`
